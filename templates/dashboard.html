
<html lang="en">
<head>
	<meta charset="utf-8" />
	<link rel="icon" type="image/png" href="/static/img/favicon.ico">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>Dashboard</title>
	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />
    <link href="/static/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/static/css/animate.min.css" rel="stylesheet"/>
    <link href="/static/css/light-bootstrap-dashboard.css?v=1.4.0" rel="stylesheet"/>
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="/static/css/pe-icon-7-stroke.css" rel="stylesheet" />
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/windbarb.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://rawgit.com/moment/moment/2.2.1/min/moment.min.js"></script>

</head>
<style type="text/css">
    #today_stat_table td{
        padding: 8px;
    }
    #today_stat_table tr{
        cursor: pointer;
    }
    .content_link{
        cursor: pointer;
    }
    .coin_table th{
        font-size: 15px;
        color: black;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }

    h2.faq_heading{
        color: #333333;
        font-size: 20px;
        font-style: bold;
        font-weight: 500;
    }
    p.faq_content{
        margin-left: 40px;
    }
    p.interior_content{
        padding-left: 10px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #6E6E6E;
      transition: .4s;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
    }

    input:checked + .slider {
      background-color: #1849AB;
    }

    input:focus + .slider {
      box-shadow: 0 0 0 4px rgba(21, 156, 228, 0.7);
      outline: none;
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .slider.round {
      border-radius: 34px;
    }

    .slider.round:before {
      border-radius: 50%;
    }
    .emp-profile{
        padding: 3%;
        margin-top: 3%;
        margin-bottom: 3%;
        border-radius: 0.5rem;
        background: #fff;
    }
    .profile-img{
        text-align: center;
    }
    .profile-img img{
        width: 17%;
        height: 21%;
    }
    .profile-img .file {
        position: absolute;
        overflow: hidden;
        margin-top: -10%;
        width: 18%;
        border: none;
        border-radius: 0;
        font-size: 15px;
        background: #212529f7;
        top: 175%;
        left: 41%;
    }
    .profile-img .file input {
        position: absolute;
        opacity: 0;
        right: 0;
        top: 0;
    }
    .profile-head h5{
        color: #333;
    }
    .profile-head h6{
        color: #0062cc;
    }
    .profile-edit-btn{
        border: none;
        border-radius: 1.5rem;
        width: 70%;
        padding: 2%;
        font-weight: 600;
        color: #6c757d;
        cursor: pointer;
    }
    .proile-rating{
        font-size: 12px;
        color: #818182;
        margin-top: 5%;
    }
    .proile-rating span{
        color: #495057;
        font-size: 15px;
        font-weight: 600;
    }
    .profile-head .nav-tabs{
        margin-bottom:5%;
    }
    .profile-head .nav-tabs .nav-link{
        font-weight:600;
        border: none;
    }
    .profile-head .nav-tabs .nav-link.active{
        border: none;
        border-bottom:2px solid #0062cc;
    }
    .profile-work{
        padding: 14%;
        margin-top: -15%;
    }
    .profile-work p{
        font-size: 12px;
        color: #818182;
        font-weight: 600;
        margin-top: 10%;
    }
    .profile-work a{
        text-decoration: none;
        color: #495057;
        font-weight: 600;
        font-size: 14px;
    }
    .profile-work ul{
        list-style: none;
    }
    .profile-tab label{
        font-weight: 600;
    }
    .profile-tab p{
        font-weight: 600;
        color: #0062cc;
    }
</style>
<body>

<div class="wrapper">
    <div class="sidebar" data-color="purple">

    <!--

        Tip 1: you can change the color of the sidebar using: data-color="blue | azure | green | orange | red | purple"
        Tip 2: you can also add an image using data-image tag

    -->

    	<div class="sidebar-wrapper">

            <ul class="nav nav_content_link">
                <li class="active">
                    <a class="content_link" id="dashboard_content_link">
                        <i class="pe-7s-graph"></i>
                        <p>Dashboard</p>
                    </a>
                </li>
                <li>
                    <a class="content_link" id="profile_content_link">
                        <i class="pe-7s-user"></i>
                        <p>User Profile</p>
                    </a>
                </li>
                <li>
                    <a class="content_link" id="table_content_link">
                        <i class="pe-7s-note2"></i>
                        <p>Table List</p>
                    </a>
                </li>
                <li>
                    <a class="content_link" id="custom_alert_content_link">
                        <i class="pe-7s-bell"></i>
                        <p>Custom Alert</p>
                    </a>
                </li>
                <li>
                    <a class="content_link" id="faq_content_link">
                        <i class="fa fa-question-circle" aria-hidden="true"></i>
                        <p>FAQ</p>
                    </a>
                </li>
            </ul>
    	</div>
    </div>

    <div class="main-panel">
        <nav class="navbar navbar-default navbar-fixed">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-example-2">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/crypto_dashboard/dashboard">Dashboard</a>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a id="logout_btn" style="cursor: pointer;">
                                <p>Log out</p>
                            </a>
                        </li>
						<li class="separator hidden-lg"></li>
                    </ul>
                </div>
            </div>
        </nav>


        <div class="content content_div" id="dashboard_content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">

                            <div class="header">
                                <h4 class="title">Your Coin</h4>
                                <p class="category">24 Hours performance</p>
                            </div>
                            <div class="content">
                                <div id="chartPreferences" class="ct-chart ct-perfect-fourth">
                                    <table class="table" id="today_stat_table">
                                      {% for coin in price_now %}
                                        <tr id='{{coin.symbol}}'>
                                            <td><img src="/static/{{coin.symbol}}.png" width="50px"><span>{{coin.name}}</span></td>
                                            {% if coin.change <= 0 %}
                                                <td id='{{coin.symbol}}_price'><i class="fa fa-inr" aria-hidden="true"></i>{{coin.curr_price}}<sup ><img src="/static/down.png" width="20px">{{coin.change}}%</sup></td>
                                            {% else %}
                                                <td id='{{coin.symbol}}_price'><i class="fa fa-inr" aria-hidden="true"></i>{{coin.curr_price}}<sup style="padding-left: 6px;"><img src="/static/up.jpg" width="9px">{{coin.change}}%</sup></td>
                                            {% endif %}
                                        </tr>
                                      {% endfor %}
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-8">
                        <div class="card">
                            <div class="header">
                                <h4 class="title selected_coin">Bitcoin</h4>
                                <p class="category">Overall Performance</p>
                            </div>
                            <div class="content">
                                <div id="coin_chart" class="ct-chart">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="col-lg-1"></div>
                        <div class="card col-lg-10">
                            <div class="header">
                                <h4 class="title selected_coin">Bitcoin</h4>
                                <p class="category">1 Week Prediction Graph</p>
                            </div>
                            <div class="content">
                                <div id="future_chart" class="ct-chart"></div>
                            </div>
                        </div>
                        <div class="col-lg-1"></div>
                    </div>
                </div>
                <div class="row">
                    <div class="card col-lg-6">
                        <div class="col-lg-12">
                            <h3 style="font-size: 20px;"><span style="padding-right: 5px;" class="selected_coin">Bitcoin</span>Trend over time</h3>
                        </div>
                        <div class="col-lg-12" id="trend_1"></div>
                    </div>
                    <div class="card col-lg-6">
                        <div class="col-lg-12">
                            <h3 style="font-size: 20px;"><span style="padding-right: 5px;" class="selected_coin">Bitcoin</span>Weekly trend</h3>
                        </div>
                        <div class="col-lg-12" id="trend_2"></div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-2"></div>
                    <div class="card col-lg-8">
                        <div class="col-lg-12">
                            <h3 style="font-size: 20px;"><span style="padding-right: 5px;" class="selected_coin">Bitcoin</span>High stock price vs time of day</h3>
                        </div>
                        <div class="col-lg-12" id="trend_3"></div>
                    </div>
                    <div class="col-lg-2"></div>
                </div>
                <div class="row">
                    <div class="col-lg-2"></div>
                    <div class="card col-lg-8">
                        <div class="col-lg-12">
                            <h3 style="font-size: 20px;"><span style="padding-right: 5px;" class="selected_coin">Bitcoin</span>model representation with trend</h3>
                        </div>
                        <div class="col-lg-12" id="base"></div>
                    </div>
                    <div class="col-lg-2"></div>
                </div>
            </div>
        </div>
        <div class="content content_div" id="table_content">
        </div>
        <div class="content content_div" id="profile_content"></div>
        <div class="content content_div" id="custom_alert_content"></div>
        <div class="content content_div" id="faq_content"></div>
    </div>
</div>


</body>
    <script src="/static/js/jquery.3.2.1.min.js" type="text/javascript"></script>
	<script src="/static/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="/static/js/chartist.min.js"></script>
    <script src="/static/js/bootstrap-notify.js"></script>
	<script src="/static/js/light-bootstrap-dashboard.js?v=1.4.0"></script>


	<script type="text/javascript">
        var coin_data = [];
        var inr_price= "{{inr_price}}";
        var price_now = JSON.parse("{{price_now}}".replace(/&#39;/g,'"'));
        var coin_overall_data= JSON.parse('{{coin_overall_data|safe}}');
        var coin_alert_val= JSON.parse('{{coin_alert_val|safe}}');
        var future_data = JSON.parse('{{future_data|safe}}');
        var coin_name_map = {'btc': ['Bitcoin','bitcoin'],'eth':["Ethereum",'ethereum'],'doge':["Doge Coin","dogecoin"],"dai":["Dai",'dai']}

        function getCookie(name) {
          var cookieValue = null;
          if (document.cookie && document.cookie != '')
          {
              var cookies = document.cookie.split(';');
              for (var i = 0; i < cookies.length; i++) {
                  var cookie = jQuery.trim(cookies[i]);
                  // Does this cookie string begin with the name we want?
                  if (cookie.substring(0, name.length + 1) == (name + '=')) {
                      cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                      break;
                  }
              }
          }
          return cookieValue;
        }
        var csrftoken = getCookie('csrftoken');

        const months = {
          0: 'Jan',
          1: 'Feb',
          2: 'March',
          3: 'April',
          4: 'May',
          5: 'June',
          6: 'July',
          7: 'Aug',
          8: 'Sept',
          9: 'Oct',
          10: 'Nov',
          11: 'Dec'
        }
        $(document).ready(function(){
            $("#btc").css('background-color','#f7deff')
            plot_coin_chart('btc')
            plot_future_prediction_graph('btc')
            setInterval(function(){
                console.log('running',new Date)
                $.ajax({
                    data:{'data_only':true},
                    url: '/crypto_dashboard/dashboard/',
                    type:"GET",
                    dataType:'json',
                    success:function(obj){
                       coin_overall_data = obj['coin_overall_data'];
                       inr_price = obj['inr_price'];
                       coin_alert_val = obj['coin_alert_val'];
                       price_now = obj['price_now'];
                       for(var i=0;i<price_now.length;i++){
                           var change_str='<i class="fa fa-inr" aria-hidden="true"></i>'+price_now[i].curr_price+'<sup ><img src="/static/down.png" width="20px">'+price_now[i].change+'%</sup>';
                           if(price_now[i].change>0){
                            var change_str='<i class="fa fa-inr" aria-hidden="true"></i>'+price_now[i].curr_price+'<sup ><img src="/static/up.jpg" width="9px">'+price_now[i].change+'%</sup>';
                           }
                           $("#"+price_now[i]['symbol']+"_price").html(change_str);
                       }
                    },
                    error:function(err)
                    {
                        console.log(JSON.stringify(err,null,4))

                    }
                })
            },40000);
        })

        function plot_coin_chart(coin){
            fetch("https://api.coingecko.com/api/v3/coins/"+coin_name_map[coin][1]+"/market_chart?vs_currency=USD&days=10&interval=hourly")
            .then(function(resp) {
            return resp.json();
            })
            .then(function(data) {
            for (var i=0;i<data.prices.length;i++){
              var price = parseFloat((data.prices[i][1]*inr_price).toFixed(2))
              coin_data.push({'x':new Date(data.prices[i][0]),'y':price})
            }
            })
            setTimeout(function(){
                coin_chart=Highcharts.chart('coin_chart', {
                    chart: {
                        zoomType: 'x'
                    },
                    title: {
                        text: coin_name_map[coin][0]+' Overall Performance'
                    },
                    xAxis: {
                        type: 'datetime',
                        dateTimeLabelFormats: {
                          day: "%e. %b",
                          month: "%b '%y",
                          year: "%Y"
                        }
                    },
                    yAxis: {
                        title: {
                            text: 'Price'
                        }
                    },
                    legend: {
                        enabled: false
                    },
                    plotOptions: {
                        area: {
                            fillColor: {
                                linearGradient: {
                                    x1: 0,
                                    y1: 0,
                                    x2: 0,
                                    y2: 1
                                },
                                stops: [
                                    [0, Highcharts.getOptions().colors[0]],
                                    [1, Highcharts.color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                                ]
                            },
                            marker: {
                                radius: 2
                            },
                            lineWidth: 1,
                            states: {
                                hover: {
                                    lineWidth: 1
                                }
                            },
                            threshold: null
                        }
                    },

                    series: [{
                        type: 'area',
                        name: 'Price',
                        data: coin_data
                    }]
                });
            }, 1000);
        }
        $(document).on('click','#today_stat_table tr',function(){
            coin_data=[];
            var coin = $(this).attr('id');
            $("#today_stat_table tr").css('background-color',"");
            $(this).css('background-color','#f7deff')
            coin_chart.destroy();
            $(".selected_coin").text(coin_name_map[coin][0])
            plot_coin_chart(coin);
            plot_future_prediction_graph(coin)
        })

        $(document).on('click','#logout_btn',function(){
            $.ajax({
                data:{},
                url: '/crypto_dashboard/logout/',
                type:"GET",
                dataType:'json',
                success:function(obj){
                    window.location="/crypto_dashboard/signin/";

                },
                error:function(err)
                {
                    console.log(JSON.stringify(err,null,4))

                }
            })
        })

        const formatNumber = n => {
          if (n < 1e3) return n.toFixed(2);
          if (n >= 1e3 && n < 1e6) return +(n / 1e3).toFixed(2) + "K";
          if (n >= 1e6 && n < 1e9) return +(n / 1e6).toFixed(2) + "M";
          if (n >= 1e9 && n < 1e12) return +(n / 1e9).toFixed(2) + "B";
          if (n >= 1e12) return +(n / 1e12).toFixed(2) + "T";
        };

        $(document).on('click',".content_link",function(){
            var id_attr = $(this).attr('id').split('_link')[0];
            $(".nav_content_link li").removeClass('active');
            $(this).parent().addClass('active');
            $(".content_div").hide();
            $("#"+id_attr).show();
            var currency_order=['BTC','ETH','DAI','DOGE']
            var table_str="";
            if(id_attr!='dashboard_content'){
                if(id_attr=='table_content'){
                    table_str +='<table class="table align-middle mb-0 bg-white coin_table"><thead class="bg-light"><tr><th>Name</th><th>Social Mentions</th><th>Social Engagements (Last 24 hrs)</th><th>Price</th><th>1 D Price Change(USD)</th><th>7 D Price Change (USD)</th><th>Market cap</th></tr></thead><tbody><tr>'
                    for(var i=0;i<currency_order.length;i++){
                        var coin = coin_overall_data[currency_order[i]];
                        var color_7="green";
                        if(coin.percent_change_7d<0){
                            color_7='red';
                        }
                        var color="green";
                        if(coin.percent_change_24h<0){
                            color='red';
                        }
                        table_str+='<tr><td><img src="/static/'+currency_order[i].toLowerCase()+'.png" width="50px"><span style="padding-left:6px;"></span>'+coin["name"]+'</td><td>'+formatNumber(coin["social_volume_calc_24h_previous"])+'</td><td>'+formatNumber(coin["social_score"])+'</td><td><i class="fa fa-inr" aria-hidden="true"></i>'+formatNumber(coin['price']*inr_price)+'</td><td style="color:'+color+'">'+coin.percent_change_24h+'</td><td style="color:'+color_7+'">'+coin.percent_change_7d+'</td><td>$'+formatNumber(coin.market_cap)+'</td></tr>'
                    }
                    table_str+='</tbody></table>'
                    $("#"+id_attr).html(table_str);
                }
                else if(id_attr=="custom_alert_content"){
                    table_str+='<table class="table align-middle mb-0 bg-white coin_table"><thead class="bg-light"><tr><th>Name</th><th>Current Price</th><th>Alert At</th><th>Buy?</th></tr></thead><tbody>'
                    for(var i=0;i<price_now.length;i++){
                        var coin = price_now[i];
                        table_str+='<tr><td><img src="/static/'+coin['symbol']+'.png" width="50px"><span style="padding-left:6px;"></span>'+coin["name"]+'</td><td><i class="fa fa-inr" aria-hidden="true"></i>'+coin.curr_price+'</td><td><input class="alert_input form-control" name="'+coin['symbol']+'" style="width:20%;" type="number" /></td><td><label class="switch"> <input type="checkbox" checkbox="'+coin['symbol']+'"><span class="slider round buy_sell" name="'+coin.symbol+'"></span></label></td></tr>'
                    }
                    table_str+="<tr><td style='text-align:center;padding:50px;' colspan='4'><button class='btn btn-primary btn-lg' id='submit_btn'>Submit</button></td></tr></tbody></table>" 
                    $("#"+id_attr).html(table_str)
                    Object.entries(coin_alert_val).forEach(([key, value]) => {
                        $(`td [name="${key}"`).val(value[0]);
                        if(value[1]==true){
                            $(`td [checkbox="${key}"`).prop('checked', value[1]);
                            $(`td .buy_sell [name="${key}"`).css({'position': 'absolute',
                                            'cursor': 'pointer',
                                            'top': '0',
                                            'left': '0',
                                            'right': '0',
                                            'bottom': '0',
                                            'background-color': '#6E6E6E',
                                            'transition': '.4s'
                                        })
                        }

                     });  
                }
                else if(id_attr=='profile_content'){
                    $.ajax({
                        data:{},
                        url: '/crypto_dashboard/render_profile_content/',
                        type:"GET",
                        dataType:'JSON',
                        success:function(html_str){
                            $("#"+id_attr).html(html_str)
                        },
                        error:function(err)
                        {
                            console.log(JSON.stringify(err,null,4))
                        }
                    })
                }
                else if(id_attr=='faq_content'){
                    $.ajax({
                        data:{},
                        url: '/crypto_dashboard/render_faq_content/',
                        type:"GET",
                        dataType:'JSON',
                        success:function(html_str){
                            $("#"+id_attr).html(html_str)
                        },
                        error:function(err)
                        {
                            console.log(JSON.stringify(err,null,4))
                        }
                    })
                }
            }
        })

        $(document).on('click','#submit_btn',function(){
            var input_data={};
            var alert_inputs = $('.alert_input');
            var buy_sell_inputs = $(".buy_sell");
            for(var i=0;i<alert_inputs.length;i++){
                input_data[$(alert_inputs[i]).attr('name')] = [$(alert_inputs[i]).val(),$(buy_sell_inputs[i]).hasClass('active')]
            }
            console.log(input_data)
            $.ajax({
                data:{'data':JSON.stringify(input_data)},
                url: '/crypto_dashboard/save_custom_alert/',
                type:"GET",
                dataType:'JSON',
                success:function(obj){
                    coin_alert_val = input_data;
                    alert('Your custom alert for coins is successfully saved')
                },
                error:function(err)
                {
                    console.log(JSON.stringify(err,null,4))
                }
            })

        })

        function plot_future_prediction_graph(coin){
            var index=$("#future_chart").data('highchartsChart');
            var chart=Highcharts.charts[index];
            if(chart!=undefined)
                chart.destroy();
            var data = future_data[coin.toUpperCase()];
            var coin_chart=Highcharts.chart('future_chart', {
                chart: {
                    zoomType: 'x'
                },
                title: {
                    text: coin_name_map[coin][0]+' 1 week prediction'
                },
                xAxis: {
                    type: 'datetime',
                    labels: {
                        formatter: function () {
                            var date = new Date(this.value*1000)
                            return date.getDate()+" "+months[date.getMonth()]+" "+date.getFullYear()
                            },
                        rotation: -45,
                    },
                    plotBands: [{
                        color: '#E5F8DB',
                        from: 1657584000,
                        to: 1658016000
                    }],
                },
                yAxis: {
                    title: {
                        text: 'Price'
                    },
                },
                legend: {
                    enabled: false
                },
                plotOptions: {
                    area: {
                        fillColor: {
                            linearGradient: {
                                x1: 0,
                                y1: 0,
                                x2: 0,
                                y2: 1
                            },
                            stops: [
                                [0, Highcharts.getOptions().colors[0]],
                                [1, Highcharts.color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                            ]
                        },
                        marker: {
                            radius: 2
                        },
                        lineWidth: 1,
                        states: {
                            hover: {
                                lineWidth: 1
                            }
                        },
                        threshold: null
                    }
                },

                series: [{
                    type: 'area',
                    name: 'Price',
                    data: data
                }]
            });
            $("#base").html("<img style='width:100%;' class='graph_img' src='/static/graph_figure/"+coin+"_base.png'>")
            $("#trend_1").html("<img style='width:94%' class='graph_img' src='/static/graph_figure/"+coin+"_trend_1.jpg'>")
            $("#trend_2").html("<img style='width:100%' class='graph_img' src='/static/graph_figure/"+coin+"_trend_2.jpg'>")
            $("#trend_3").html("<img style='width:100%' class='graph_img' src='/static/graph_figure/"+coin+"_trend_3.jpg'>")
        }
        $(document).on('click','.slider',function(){
            if($(this).hasClass("active")){
                $(this).removeClass("active");
            }
            else{
                $(this).addClass('active');
            }
        })
	</script>

</html>
